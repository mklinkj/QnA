# cve-2024-22234-test

* https://nvd.nist.gov/vuln/detail/CVE-2024-22234

Spring Security 6.1.7 이전 버전과 6.2.2 이전 버전에서는 애플리케이션이`AuthenticationTrustResolver.isFullyAuthenticated(Authentication)` 메서드를 직접 사용할 때 액세스 제어가 손상될 수 있습니다. 

구체적으로 다음과 같은 경우 애플리케이션이 취약합니다: 

애플리케이션이 AuthenticationTrustResolver.isFullyAuthenticated(Authentication)를 직접 사용하며 `null` Authentication 매개변수가 전달되어 잘못된 true 반환값이 발생하는 경우. 



다음 중 하나라도 참이면 애플리케이션은 취약하지 않습니다: 

* 애플리케이션이 AuthenticationTrustResolver.isFullyAuthenticated(Authentication)를 직접 사용하지 않는 경우. 
* 애플리케이션이 AuthenticationTrustResolver.isFullyAuthenticated에 null을 전달하지 않음
* 애플리케이션이 메서드 보안 (https://docs.spring.io/spring-security/reference/servlet/authorization/method-security.html) 또는 HTTP 요청 보안 (https://docs.spring.io/spring-security/reference/servlet/authorization/authorize-http-requests.html) 을 통해서만 `isFullyAuthenticated`를 사용함.



---

뭔말인지 궁금해서 다른 것 확인하던 예제 프로젝트 코드를 바꿔서 보았는데...



굳이 다음 빈을 생성해봄 😅

```java
  @Bean
  AuthenticationTrustResolver authenticationTrustResolver() {
    return new AuthenticationTrustResolverImpl();
  }
```

그리고 테스트를 돌림...

```java
class CveTests {
  @Autowired private AuthenticationTrustResolver resolver;
  @Test
  void test() {
    assertThat(resolver.isFullyAuthenticated(null)) //
        .isTrue();
  }
}
```



그러면 정말로 6.2.1 버전에서는 true로 반환하긴한다.

6.2.2에서는 방어 코드가 있어서..  isFullyAuthenticated(Authentication authentication) 에서 authentication가 null 이면 false로 처리함.



빙의 이야기..

> Spring Security에서 `AuthenticationTrustResolver`는 기본적으로 `AuthenticationTrustResolverImpl`의 인스턴스를 사용합니다. 그러나 이 인스턴스는 일반적으로 Spring의 애플리케이션 컨텍스트에 빈으로 등록되지 않습니다. 대신, `AuthenticationTrustResolverImpl`의 인스턴스는 필요에 따라 Spring Security 내부에서 직접 생성되고 사용됩니다.
>
> 따라서, `AuthenticationTrustResolver` 타입의 빈을 `@Autowired`로 주입하려고 하면, Spring은 해당 타입의 빈을 찾을 수 없어 오류를 발생시킵니다.



그런데 내가 이렇게 빈으로 굳이 만들어서 실행한 것 자체가 이상하긴 하다. 😅

일반적인 상황이 아닌 것 같음.
